{
    "targets": [
        {
            "target_name": "node-av",
            "sources": [
                "src/bindings/index.cc",
                "src/bindings/packet.cc",
                "src/bindings/frame.cc",
                "src/bindings/frame_async.cc",
                "src/bindings/frame_sync.cc",
                "src/bindings/codec.cc",
                "src/bindings/codec_context.cc",
                "src/bindings/codec_context_async.cc",
                "src/bindings/codec_context_sync.cc",
                "src/bindings/codec_parameters.cc",
                "src/bindings/codec_parser.cc",
                "src/bindings/format_context.cc",
                "src/bindings/format_context_async.cc",
                "src/bindings/format_context_sync.cc",
                "src/bindings/stream.cc",
                "src/bindings/dictionary.cc",
                "src/bindings/input_format.cc",
                "src/bindings/input_format_async.cc",
                "src/bindings/input_format_sync.cc",
                "src/bindings/output_format.cc",
                "src/bindings/io_context.cc",
                "src/bindings/io_context_async.cc",
                "src/bindings/io_context_sync.cc",
                "src/bindings/error.cc",
                "src/bindings/software_scale_context.cc",
                "src/bindings/software_scale_context_async.cc",
                "src/bindings/software_scale_context_sync.cc",
                "src/bindings/software_resample_context.cc",
                "src/bindings/software_resample_context_async.cc",
                "src/bindings/software_resample_context_sync.cc",
                "src/bindings/filter.cc",
                "src/bindings/filter_context.cc",
                "src/bindings/filter_context_async.cc",
                "src/bindings/filter_context_sync.cc",
                "src/bindings/filter_graph.cc",
                "src/bindings/filter_graph_async.cc",
                "src/bindings/filter_graph_sync.cc",
                "src/bindings/filter_graph_segment.cc",
                "src/bindings/filter_inout.cc",
                "src/bindings/hardware_device_context.cc",
                "src/bindings/hardware_frames_context.cc",
                "src/bindings/hardware_frames_context_async.cc",
                "src/bindings/hardware_frames_context_sync.cc",
                "src/bindings/log.cc",
                "src/bindings/utilities.cc",
                "src/bindings/audio_fifo.cc",
                "src/bindings/audio_fifo_async.cc",
                "src/bindings/audio_fifo_sync.cc",
                "src/bindings/frame_utils.cc",
                "src/bindings/bitstream_filter.cc",
                "src/bindings/bitstream_filter_context.cc",
                "src/bindings/bitstream_filter_context_async.cc",
                "src/bindings/bitstream_filter_context_sync.cc",
                "src/bindings/option.cc",
            ],
            "include_dirs": [
                "<!@(node -p \"require('node-addon-api').include\")",
                "/opt/ffbuild/prefix/include",
                "<(module_root_dir)/externals/jellyfin-ffmpeg",
            ],
            "library_dirs": ["/opt/ffbuild/prefix/lib"],
            "dependencies": ["<!(node -p \"require('node-addon-api').gyp\")"],
            "cflags!": ["-fno-exceptions"],
            "cflags_cc!": ["-fno-exceptions"],
            "defines": ["NAPI_DISABLE_CPP_EXCEPTIONS"],
            "libraries": [
                "-Wl,-force_load,/opt/ffbuild/prefix/lib/libavformat.a",
                "-Wl,-force_load,/opt/ffbuild/prefix/lib/libavcodec.a",
                "-Wl,-force_load,/opt/ffbuild/prefix/lib/libavfilter.a",
                "-Wl,-force_load,/opt/ffbuild/prefix/lib/libavutil.a",
                "-Wl,-force_load,/opt/ffbuild/prefix/lib/libswscale.a",
                "-Wl,-force_load,/opt/ffbuild/prefix/lib/libswresample.a",
                "-Wl,-force_load,/opt/ffbuild/prefix/lib/libavdevice.a",
                "-L/opt/ffbuild/prefix/lib",
                "/opt/ffbuild/prefix/lib/libx264.a",
                "/opt/ffbuild/prefix/lib/libx265.a",
                "/opt/ffbuild/prefix/lib/libvpx.a",
                "/opt/ffbuild/prefix/lib/libopus.a",
                "/opt/ffbuild/prefix/lib/libmp3lame.a",
                "/opt/ffbuild/prefix/lib/libdav1d.a",
                "/opt/ffbuild/prefix/lib/libSvtAv1Enc.a",
                "/opt/ffbuild/prefix/lib/libogg.a",
                "/opt/ffbuild/prefix/lib/libvorbis.a",
                "/opt/ffbuild/prefix/lib/libvorbisenc.a",
                "/opt/ffbuild/prefix/lib/libtheora.a",
                "/opt/ffbuild/prefix/lib/libtheoraenc.a",
                "/opt/ffbuild/prefix/lib/libtheoradec.a",
                "/opt/ffbuild/prefix/lib/libwebp.a",
                "/opt/ffbuild/prefix/lib/libwebpmux.a",
                "/opt/ffbuild/prefix/lib/libsrt.a",
                "/opt/ffbuild/prefix/lib/libass.a",
                "/opt/ffbuild/prefix/lib/libharfbuzz.a",
                "/opt/ffbuild/prefix/lib/libfontconfig.a",
                "/opt/ffbuild/prefix/lib/libfreetype.a",
                "/opt/ffbuild/prefix/lib/libfribidi.a",
                "/opt/ffbuild/prefix/lib/libbluray.a",
                "/opt/ffbuild/prefix/lib/libudfread.a",
                "/opt/ffbuild/prefix/lib/libz.a",
                "/opt/ffbuild/prefix/lib/liblzma.a",
                "<!@(ls /opt/ffbuild/prefix/lib/libNE10.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libwebpdemux.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libchromaprint.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libopenmpt.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libxml2.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libbz2.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libzvbi.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libzimg.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libgmp.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libssl.a 2>/dev/null || echo '')",
                "<!@(ls /opt/ffbuild/prefix/lib/libcrypto.a 2>/dev/null || echo '')",
                "-liconv",
                "-lxml2",
                "-lbz2",
                "-framework CoreFoundation",
                "-framework CoreVideo",
                "-framework CoreMedia",
                "-framework CoreServices",
                "-framework AudioToolbox",
                "-framework VideoToolbox",
                "-framework AVFoundation",
                "-framework AppKit",
                "-framework Accelerate",
                "-framework Security",
                "-framework IOKit",
                "-framework OpenGL",
                "-framework Metal",
                "-framework OpenCL",
            ],
            "xcode_settings": {
                "GCC_ENABLE_CPP_EXCEPTIONS": "YES",
                "CLANG_CXX_LIBRARY": "libc++",
                "CLANG_CXX_LANGUAGE_STANDARD": "c++17",
                "MACOSX_DEPLOYMENT_TARGET": "12.0",
                "OTHER_CPLUSPLUSFLAGS": [
                    "-fexceptions",
                    "-O3",
                ],
                "OTHER_LDFLAGS": [
                    "-Wl,-dead_strip",
                    "-Wl,-no_warn_duplicate_libraries",
                ],
                "CONDITIONS": [
                    ["target_arch=='x64'", {"ARCHS": ["x86_64"]}],
                    ["target_arch=='arm64'", {"ARCHS": ["arm64"]}],
                ],
            },
        }
    ]
}
